<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Agendamento de Carros</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family: Arial, sans-serif;
  background:#f4f6f8;
  margin:0;
  padding:20px;
}
.container{
  max-width:900px;
  margin:auto;
  background:#fff;
  padding:20px;
  border-radius:8px;
}
h1{
  margin-top:0;
  text-align:center;
}
.calendar{
  display:grid;
  grid-template-columns:repeat(7,1fr);
  gap:5px;
  margin-bottom:20px;
}
.day{
  padding:10px;
  background:#e9ecef;
  text-align:center;
  border-radius:4px;
  cursor:pointer;
}
.day:hover{
  background:#ced4da;
}
.day.selected{
  background:#0d6efd;
  color:#fff;
}
.form{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
  margin-bottom:20px;
}
.form input, .form select, .form button{
  padding:8px;
  font-size:14px;
}
.form button{
  grid-column:1/3;
  background:#0d6efd;
  color:#fff;
  border:none;
  cursor:pointer;
}
.form button:hover{
  background:#0b5ed7;
}
.list{
  border-top:1px solid #ddd;
  padding-top:10px;
}
.item{
  padding:8px;
  border-bottom:1px solid #eee;
  display:flex;
  justify-content:space-between;
  font-size:14px;
}
.small{
  font-size:12px;
  color:#666;
}
</style>
</head>

<body>
<div class="container">
<h1>Agendamento de Carros</h1>

<div id="calendar" class="calendar"></div>

<div class="form">
  <select id="car">
    <option value="Triton">Triton</option>
    <option value="Strada">Strada</option>
  </select>

  <input id="user" placeholder="Quem vai usar">

  <input type="time" id="start">
  <input type="time" id="end">

  <button onclick="save()">Salvar Agendamento</button>
</div>

<h3>Agendamentos do dia</h3>
<div id="list" class="list"></div>

</div>

<script>
const STORAGE = "agenda_carros";
let selectedDate = new Date();

function load(){
  return JSON.parse(localStorage.getItem(STORAGE) || "[]");
}
function saveStorage(data){
  localStorage.setItem(STORAGE, JSON.stringify(data));
}

function renderCalendar(){
  const cal = document.getElementById("calendar");
  cal.innerHTML = "";
  const year = selectedDate.getFullYear();
  const month = selectedDate.getMonth();
  const days = new Date(year, month+1, 0).getDate();

  for(let d=1; d<=days; d++){
    const el = document.createElement("div");
    el.className = "day";
    el.innerText = d;
    const date = new Date(year, month, d);

    if(date.toDateString() === selectedDate.toDateString()){
      el.classList.add("selected");
    }

    el.onclick = ()=>{
      selectedDate = date;
      renderCalendar();
      renderList();
    };
    cal.appendChild(el);
  }
}

function renderList(){
  const list = document.getElementById("list");
  list.innerHTML = "";
  const data = load();

  const dayItems = data.filter(i =>
    i.date === selectedDate.toISOString().split("T")[0]
  );

  if(dayItems.length === 0){
    list.innerHTML = "<div class='small'>Nenhum agendamento</div>";
    return;
  }

  dayItems.forEach(i=>{
    const div = document.createElement("div");
    div.className = "item";
    div.innerHTML = `
      <div>
        <strong>${i.car}</strong> - ${i.user}<br>
        <span class="small">${i.start} às ${i.end}</span>
      </div>
    `;
    list.appendChild(div);
  });
}

function save(){
  const car = document.getElementById("car").value;
  const user = document.getElementById("user").value;
  const start = document.getElementById("start").value;
  const end = document.getElementById("end").value;

  if(!user || !start || !end){
    alert("Preencha tudo");
    return;
  }

  if(end <= start){
    alert("Hora final deve ser maior que a inicial");
    return;
  }

  const date = selectedDate.toISOString().split("T")[0];
  const data = load();

  const conflict = data.some(i =>
    i.car === car &&
    i.date === date &&
    start < i.end &&
    end > i.start
  );

  if(conflict){
    alert("Conflito de horário para este carro");
    return;
  }

  data.push({car, user, date, start, end});
  saveStorage(data);

  document.getElementById("user").value = "";
  renderList();
}

renderCalendar();
renderList();
</script>

</body>
</html>
